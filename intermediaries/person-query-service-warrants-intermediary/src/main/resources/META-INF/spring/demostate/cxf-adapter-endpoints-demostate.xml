<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:cxf="http://camel.apache.org/schema/cxf"
    xmlns:wsa="http://cxf.apache.org/ws/addressing"
    xmlns:wsp="http://www.w3.org/2006/07/ws-policy"
    xmlns:policy="http://cxf.apache.org/policy"       
    xmlns:camel="http://camel.apache.org/schema/spring"
    xmlns:util="http://www.springframework.org/schema/util"
    xmlns:http="http://cxf.apache.org/transports/http/configuration"
    xmlns:sec="http://cxf.apache.org/configuration/security"
    xsi:schemaLocation="
    http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
    http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd
    http://camel.apache.org/schema/cxf http://camel.apache.org/schema/cxf/camel-cxf.xsd
    http://cxf.apache.org/policy http://cxf.apache.org/schemas/policy.xsd
    http://www.w3.org/2006/07/ws-policy http://www.w3.org/2006/07/ws-policy.xsd
    http://cxf.apache.org/ws/addressing http://cxf.apache.org/schemas/ws-addr-conf.xsd
    http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd
    http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.0.xsd
    http://cxf.apache.org/transports/http/configuration http://cxf.apache.org/schemas/configuration/http-conf.xsd
    http://cxf.apache.org/configuration/security	http://cxf.apache.org/schemas/configuration/security.xsd
    ">
    
    <camel:endpoint id="personQueryRequestWarrantsServiceDemostateEndpoint" uri="cxf:bean:personQueryRequestWarrantsServiceDemostate?dataFormat=PAYLOAD&amp;loggingFeatureEnabled=${personQuery.warrants.personQueryIntermediaryCxflogging}"/>
	<camel:endpoint id="presentPersonQueryResultsWarrantsServiceEndpoint" uri="cxf:bean:presentPersonQueryResultsWarrantsService?dataFormat=PAYLOAD&amp;loggingFeatureEnabled=${personQuery.warrants.personQueryIntermediaryCxflogging}"/>                        
                        
    <!-- Warrants Request Service Demostate, HIJIS Adapter -->
	<cxf:cxfEndpoint id="personQueryRequestWarrantsServiceDemostate"
		address="${federatedQuery.warrants.personQueryWarrantsEndpoint}"
        wsdlURL="classpath:service-specifications/Person_Query_Service_-_Warrants/schema/SIP_WS_1.2/Person_Query_Service_-_Warrants.wsdl"
        serviceName="ojbc:Person-Query-Service---WarrantsService"
		endpointName="ojbc:Person-Query-Secure-Service---Warrants"
        xmlns:ojbc="http://ojbc.org/Services/WSDL/Person_Query_Service-Warrants/1.0">
		<cxf:properties>
			<entry key="ws-security.saml-callback-handler" value-ref="ojbSamlCallbackHandler"/>
			<entry key="ws-security.callback-handler" value-ref="passwordCallbackHandler" />
			<entry key="ws-security.signature.properties" value-ref="warrantsRequestKeystoreProperties" />
			<entry key="ws-security.signature.username" value="${federatedQuery.warrants.keystoreCertificateAlias}" />
		</cxf:properties>
	</cxf:cxfEndpoint>
	
    <!-- Present Person Query Results Demostate, Hosted by Web App-->
    <cxf:cxfEndpoint 
        id="presentPersonQueryResultsWarrantsService"
        address="${federatedQuery.warrants.presentPersonQueryResultsEndpoint}"
        wsdlURL="classpath:service-specifications/Person_Query_Results_Handler_Service_-_Warrants/schema/SIP_WS_1.2/Person_Query_Results_Handler_Service_-_Warrants.wsdl"
        serviceName="ojbc:Person-Query-Results-Handler-Service---WarrantsService"
		endpointName="ojbc:Person-Query-Results-Handler-Service---Warrants"
        xmlns:ojbc="http://ojbc.org/Services/WSDL/Person_Query_Results_Handler_Service-Warrants/1.0"
     >
     <cxf:features>
      <policy:policies>
        <wsp:Policy xmlns:wsam="http://www.w3.org/2007/02/addressing/metadata">
          <wsam:Addressing>
            <wsp:Policy/>
          </wsam:Addressing>
        </wsp:Policy>
       </policy:policies>
    </cxf:features>
    </cxf:cxfEndpoint>
    
    <bean id="federatedQueryMessageProcessor" class="org.ojbc.processor.federatedQuery.FederatedQueryMessageProcessor">
		<property name="federatedQueryManager">
			<ref bean="federatedQueryManager" />
		</property>
		<property name="federatedQueryEndpointMap">
			<util:map map-class="java.util.HashMap">
				<entry key="{http://ojbc.org/Services/WSDL/Person_Query_Service-Warrants/1.0}Person-Query-Service---Warrants" value="personQueryRequestWarrantsServiceDemostateEndpoint" />
			</util:map>
		</property>
	</bean>

	<bean class="org.ojbc.saml.OJBSamlCallbackHandler" id="ojbSamlCallbackHandler">
		<property name="OJBSamlMap" ref="ojbSamlMap"/>
	</bean>

	<!-- Used for SSL/TLS Connection. No CCA, just SSL. -->
	<http:conduit
		name="https://.*">
		<http:tlsClientParameters disableCNCheck="true">
			<sec:trustManagers>
				<sec:keyStore type="JKS"
					password="${federatedQuery.warrants.truststorePassword}"
					file="${federatedQuery.warrants.truststoreLocation}" />
			</sec:trustManagers>
			<sec:cipherSuitesFilter>
					<!-- these filters ensure that a strong ciphersuite will be used --> 
				    <sec:include>TLS_DHE_RSA_WITH_AES_128_CBC_SHA</sec:include>
				    <sec:include>SSL_DHE_RSA_WITH_3DES_EDE_CBC_SHA</sec:include>
				    <sec:include>TLS_RSA_WITH_AES_128_CBC_SHA</sec:include>
				    <sec:include>SSL_RSA_WITH_3DES_EDE_CBC_SHA</sec:include>
			</sec:cipherSuitesFilter>
		</http:tlsClientParameters>
		<http:client AutoRedirect="true" Connection="Keep-Alive" />
	</http:conduit>
	
	<bean id="WSAddressingEndpointProcessor" class="org.ojbc.processor.WSAddressingEndpointProcessor">
		<property name ="endpointReplyToMap">
			<util:map map-class="java.util.HashMap" key-type="java.lang.String" value-type="java.lang.String">
		        <entry key="${federatedQuery.warrants.presentPersonQueryResultsEndpoint}" value="presentPersonQueryResultsWarrantsServiceEndpoint"/>
	   		</util:map>
   		</property>
	</bean>	
	

</beans>